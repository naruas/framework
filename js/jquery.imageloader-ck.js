(function(e){"use strict";var t={selector:"",dataattr:"src",background:!1,each:null,eacherror:null,callback:null,timeout:5e3},n=function(n,o,a){var f=u.getInstance(),l=e(o),c=e.extend({},t,a||{}),h="_"+(""+(new Date).valueOf()).slice(-7),p,d=0;if(c.selector===""&&l.data(c.dataattr)){p=l;d=1}else{p=l.find([c.selector,"[data-",c.dataattr,"]"].join(""));d=p.length}l.data(h,{each:c.each,eacherror:c.eacherror,callback:c.callback,isLoading:!0,loadedImageCounter:0,length:d});if(d===0)i(o,h);else{p.each(function(e,t){f.add(s(t,o,h,c.background,c.dataattr,c.timeout))});l.on("loadImage."+h,r);f.run()}return o},r=function(t,n,r,s){var o=t.currentTarget,u=e(o).data(t.namespace);if(!u.isLoading)return;s?typeof u.eacherror=="function"?u.eacherror(n):n.parentNode!==null&&n.parentNode.removeChild(n):typeof u.each=="function"&&u.each(n,r);++u.loadedImageCounter;u.loadedImageCounter>=u.length&&i(o,t.namespace)},i=function(t,n){var i=e(t),s=i.data(),o=s[n].callback;i.off("loadImage."+n,r);delete s[n];typeof o=="function"&&setTimeout(function(){o(t)},e.imageloader.queueInterval*2)},s=function(t,n,r,i,s,o){var u=e(t),a=u.data(s),f=!1,l=function(i,o){u.removeAttr(["data-",s].join(""));e(n).triggerHandler("loadImage."+r,[t,o,i&&i.type==="error"])};return function(){var t,n=e("<img />");n.bind("error",function(n){f=!0;clearTimeout(t);e(this).unbind("error").unbind("load");l(n)}).bind("load",function(r){f=!0;clearTimeout(t);e(this).unbind("error").unbind("load");i?u.css("background-image",["url(",a,")"].join("")):u.attr("src",a);l(r,n[0])}).attr("src",a);t=setTimeout(function(){f===!1&&n.trigger("error")},o)}},o,u={getInstance:function(){o instanceof a==0&&(o=new a);return o}},a=function(){this.index=0;this.queue=[];this.isRunning=!1};a.prototype.add=function(e){if(typeof e!="function")throw new Error("you can only pass function.");this.queue.push(e)};a.prototype.run=function(t){var n=e.proxy(this.run,this);t=t||!1;if(this.isRunning&&!t)return;this.isRunning=!0;this.queue[this.index++]();this.index<this.queue.length?setTimeout(function(){n(!0)},e.imageloader.queueInterval):this.isRunning=!1};e.imageloader={queueInterval:17};e.fn.imageloader=function(e){return this.each(function(t,r){n(t,r,e)})}})(jQuery);